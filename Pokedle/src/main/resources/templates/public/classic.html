<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Classic</title>

<script src="https://cdn.tailwindcss.com"></script>
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
	rel="stylesheet" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous" />
<link rel="stylesheet" href="../styles/styles.css" />
<link rel="stylesheet" href="../styles/tablaPokemon.css" />
</head>
<body>
	<div class="flex-container">
		<div class="title">
			<img src="../src/img/pokedleLogo.png" alt="Pokedle" class="title" />
		</div>
		<div class="space-y-4 w-1/4">
			<a href="../public"
				class="button flex items-center justify-between border-2 border-black p-2 bg-white transition-transform duration-200 ease-in-out w-full">
				<span class="custom-font text-black text-x1">Inicio</span> <img
				alt="pokeball icon" height="100" src="../src/img/pokeball.png"
				width="60" />
			</a>
		</div>
		<div>
			<a hidden id="try">1</a> <input id="pokeTry" type="text">
			<button
				class="button flex items-center justify-between border-2 border-black p-2 bg-white transition-transform duration-200 ease-in-out w-full"
				onclick="intentarPokemon(document.getElementById('pokeTry'));">Intentar</button>
		</div>
		<div class="tabla">
			<table id="pokemon-table">
				<tr>
					<!-- encabezado fijo -->
					<th class="pixel">Pokemon</th>
					<th class="pixel">Tipo_1</th>
					<th class="pixel">Tipo_2</th>
					<th class="pixel">Evoluci칩n</th>
					<th class="pixel">Evoluci칩n m치xima</th>
					<th class="pixel">Color</th>
					<th class="pixel">Habitat</th>
					<th class="pixel">Generaci칩n</th>
				</tr>
				<tbody id="tbody">

				</tbody>
			</table>
		</div>
	</div>
	<script>
		var randPoke = Math.floor(Math.random()* 1027 + 1);
		var tabla = document.getElementById("tbody");
		
		async function crearTr(n){
			var newRow = document.createElement("tr");
			newRow.setAttribute('id',('apiRow' + parseInt(n)));
			tabla.prepend(newRow);
			
		}
		
		async function todayPokemon(){
			const response = await fetch('https://pokeapi.co/api/v2/pokemon/1');
		    const data = await response.json();

		    return data;
		}
		async function todayPokemonSpecie(){
			const response = await fetch('https://pokeapi.co/api/v2/pokemon-species/1');
		    const data = await response.json();

		    return data;
		}
		
		async function todayPokemonChain(){
			const response = await fetch('https://pokeapi.co/api/v2/evolution-chain/1');
		    const data = await response.json();

		    return data;
		}
		
		async function intentarPokemon(id) {
			const todayPoke = await todayPokemon();
			const todayPokeSpecie = await todayPokemonSpecie();
			const todayPokeChain= await todayPokemonChain();
			
			var intento = document.getElementById("try");
			crearTr(intento.innerText);
			
			var colNa = document.createElement('td');
			var colT1 = document.createElement('td');
			var colT2 = document.createElement('td');
			var colEv = document.createElement('td');
			var colEvolutionM = document.createElement('td');
			var colColor = document.createElement('td');
			var colHab = document.createElement('td');
			var colGen = document.createElement('td');
			
			var apiRow = document.getElementById("apiRow" + intento.innerText);
			fetch("https://pokeapi.co/api/v2/pokemon/" + id.value)
			    .then(response => response.json())
			    .then(data => {
			    	
			    	
			    	colNa.id = "name";
			    	colNa.innerText = data.forms[0].name;

			    	colT1.id = "type1";
			    	colT1.innerText = data.types[0].type.name;

			    	colT2.id = "type2";
			    	colT2.innerText = typeof data.types[1] === "undefined"? "None" : data.types[1].type.name;
			    	
			    	if(todayPoke.name == data.name){
		    			colNa.className = "pixel bg-[#00ff00]"	
			    	}
			    	else{
			    		colNa.className = "pixel bg-[#ff0000]"
			    	}
			    	if(todayPoke.types[0].type.name == data.types[0].type.name){
		    			colT1.className = "pixel bg-[#00ff00]"
			    	}
			    	else{
			    		colT1.className = "pixel bg-[#ff0000]"
			    	}
			    	if(typeof todayPoke.types[1] !== "undefined" && typeof data.types[1] !== "undefined")
			    		if(todayPoke.types[1].type.name == data.types[1].type.name){
		    				colT2.className = "pixel bg-[#00ff00]"
			    		}
			    		else{
			    			colT2.className = "pixel bg-[#ff0000]"
			    		}
			    	else{
			    		colT2.className = "pixel bg-[#aaaaaa]"
			    	}
					///////////////////////////////////////
			    	fetch("https://pokeapi.co/api/v2/pokemon-species/" + data.id + "/")
				    .then(response => response.json())
				    .then(data => {
						var url = "https://pokeapi.co/api/v2/pokemon-species/" + data.id + "/";
						colColor.id = "color";
				    	colColor.innerText = data.color.name;
				    	
				    	
				    	colHab.id = "habitat";
				    	colHab.innerText = data.habitat == null ? "None" : data.habitat.name;
						
				    	var gen = "";
				    	
				    	if(data.id >= 1 && data.id <= 151){
				    		gen = 1
				    	} 
				    	else if(data.id >= 152 && data.id <= 251){
				    		gen = 2
				    	}
				    	else if(data.id >= 252 && data.id <= 386){
				    		gen = 3
				    	}
				    	else if(data.id >= 387 && data.id <= 493){
				    		gen = 4
				    	}
				    	else if(data.id >= 494 && data.id <= 649){
				    		gen = 5
				    	}
				    	else if(data.id >= 650 && data.id <= 721){
				    		gen = 6
				    	}
				    	else if(data.id >= 722 && data.id <= 809){
				    		gen = 7
				    	}
				    	else if(data.id >= 810 && data.id <= 897){
				    		gen = 8
				    	}
				    	else if(data.id >= 898 && data.id <= 1025){
				    		gen = 9
				    	}
				    	else{
				    		gen = 10
				    	}
				    	colGen.id = "generation";
				    	colGen.innerText = gen;
				    	
						var Tgen = "";
				    	
				    	if(todayPoke.id >= 1 && todayPoke.id <= 151){
				    		Tgen = 1
				    	} 
				    	else if(todayPoke.id >= 152 && todayPoke.id <= 251){
				    		Tgen = 2
				    	}
				    	else if(todayPoke.id >= 252 && todayPoke.id <= 386){
				    		Tgen = 3
				    	}
				    	else if(todayPoke.id >= 387 && todayPoke.id <= 493){
				    		Tgen = 4
				    	}
				    	else if(todayPoke.id >= 494 && todayPoke.id <= 649){
				    		Tgen = 5
				    	}
				    	else if(todayPoke.id >= 650 && todayPoke.id <= 721){
				    		Tgen = 6
				    	}
				    	else if(todayPoke.id >= 722 && todayPoke.id <= 809){
				    		Tgen = 7
				    	}
				    	else if(todayPoke.id >= 810 && todayPoke.id <= 897){
				    		Tgen = 8
				    	}
				    	else if(todayPoke.id >= 898 && todayPoke.id <= 1025){
				    		Tgen = 9
				    	}
				    	else{
				    		Tgen = 10
				    	}
				    	if(Tgen == gen){
			    			colGen.className = "pixel bg-[#00ff00]"
				    	}
				    	else{
				    		colGen.className = "pixel bg-[#ff0000]"
				    	}
				    	
				    	if(todayPokeSpecie.color.name == data.color.name){
				    		colColor.className = "pixel bg-[#00ff00]"	
				    	}
				    	else{
				    		colColor.className = "pixel bg-[#ff0000]"
				    	}
				    	if(todayPokeSpecie.habitat !== null)
					    	if(todayPokeSpecie.habitat.name == data.habitat.name){
				    			colHab.className = "pixel bg-[#00ff00]"
					    	}
					    	else{
					    		colHab.className = "pixel bg-[#ff0000]"
					    	}
						
				    	fetch(data.evolution_chain.url)
					    .then(response => response.json())
					    .then(data => {
					    	var evoAct = 1;
					    	var evos = 1;
					    	
					    	var foundEvo = false;
					    	var foundMax = false;
					    	
					    	var nextSpecie = data.chain.evolves_to;
					    	var chainSpecie = data.chain;
					    	
					    	for (var i = 0; !foundMax; i++){
					    		if(Object.keys(nextSpecie).length > 0){
					    			evos += 1;
					    			
					    			nextSpecie = nextSpecie[0].evolves_to;
					    		}
					    		else{
					    			foundMax = !foundMax;
					    		}
					    	}

					    	var nextSpecie = data.chain.evolves_to;
					    	var chainSpecie = data.chain;
					    	
					    	for (var i = 0; i < 10; i++){
					    		
					    		if(Object.keys(nextSpecie).length > 0){
					    			if(chainSpecie.species.url == url && !foundEvo){
					    				foundEvo = !foundEvo;
						    			chainSpecie = nextSpecie[0];
						    		}
					    			else if (foundEvo == false || chainSpecie.species.url == url){
					    				evoAct += 1;
					    				chainSpecie = nextSpecie[0];
						    		}
					    			nextSpecie = nextSpecie[0].evolves_to;
					    		}
					    	}
					    	
					    	colEv.id = "evolution";
					    	colEv.innerText = evoAct;
					    	
					    	colEvolutionM.id = "evolutionMax";
					    	colEvolutionM.innerText = evos;
					    	
					    	//TODAYPOKEMON EVOLUTION CHAIN
					    	var TevoAct = 1;
					    	var Tevos = 1;
					    	
					    	var TfoundEvo = false;
					    	var TfoundMax = false;
					    	
					    	var nextSpecie = todayPokeChain.chain.evolves_to;
					    	var chainSpecie = todayPokeChain.chain;
					    	
					    	for (var i = 0; !TfoundMax; i++){
					    		if(Object.keys(nextSpecie).length > 0){
					    			Tevos += 1;
					    			
					    			nextSpecie = nextSpecie[0].evolves_to;
					    		}
					    		else{
					    			TfoundMax = !TfoundMax;
					    		}
					    	}

					    	var nextSpecie = todayPokeChain.chain.evolves_to;
					    	var chainSpecie = todayPokeChain.chain;
					    	
					    	for (var i = 0; i < 10; i++){
					    		
					    		if(Object.keys(nextSpecie).length > 0){
					    			if(chainSpecie.species.url == todayPokeSpecie.evolution_chain.url && !TfoundEvo){
					    				TfoundEvo = !TfoundEvo;
						    			chainSpecie = nextSpecie[0];
						    		}
					    			else if (TfoundEvo !== false || chainSpecie.species.url == todayPokeSpecie.evolution_chain.url){
					    				TevoAct += 1;
					    				chainSpecie = nextSpecie[0];
						    		}
					    			nextSpecie = nextSpecie[0].evolves_to;
					    		}
					    	}
					    	console.log(todayPokeSpecie.evolution_chain.url)
					    	//todayPokeSpecie.evolution_chain.url
					    	console.log(TevoAct + " " + evoAct)
					    	console.log(Tevos + " " + evos)
					    	if(TevoAct == evoAct){
				    			colEv.className = "pixel bg-[#00ff00]"	
					    	}
					    	else{
					    		colEv.className = "pixel bg-[#ff0000]"
					    	}
					    	if(Tevos == evos){
					    		colEvolutionM.className = "pixel bg-[#00ff00]"
					    	}
					    	else{
					    		colEvolutionM.className = "pixel bg-[#ff0000]"
					    	}
					    })
				    
				    })
				    
				    intento.innerText = parseInt(intento.innerText) + 1;
			    	apiRow.appendChild(colNa);
			    	apiRow.appendChild(colT1);
			    	apiRow.appendChild(colT2);
			    	apiRow.appendChild(colEv);
			    	apiRow.appendChild(colEvolutionM);
			    	apiRow.appendChild(colColor);
			    	apiRow.appendChild(colHab);
			    	apiRow.appendChild(colGen);
			    	document.getElementById("pokeTry").value = "";
			    	mostrarCeldas();
			    })
			    .catch(error => console.error("Error fetching data:", error));
			}
		
		async function mostrarCeldas(){
			const tabla = document.getElementById("pokemon-table");
			const filas = tabla.rows;
		}
		
		async function comprobarPokemon(){
			const tabla = document.getElementById("pokemon-table");
			const filas = tabla.rows;

			fetch("https://pokeapi.co/api/v2/pokemon/" + id.value)
			    .then(response => response.json())
			    .then(data => {
			    	
			    	//if (data.forms[0].name == )
			    	colNa.className = "pixel";
			    	colNa.innerText = data.forms[0].name;

			    	colT1.className = "pixel";
			    	colT1.innerText = data.types[0].type.name;

			    	colT2.className = "pixel";
			    	colT2.innerText = typeof data.types[1] === "undefined"? "None" : data.types[1].type.name;
					///////////////////////////////////////
			    	fetch("https://pokeapi.co/api/v2/pokemon-species/" + data.id + "/")
				    .then(response => response.json())
				    .then(data => {
						var url = "https://pokeapi.co/api/v2/pokemon-species/" + data.id + "/";
				    	colColor.className = "pixel";
				    	colColor.innerText = data.color.name;
	
				    	colHab.className = "pixel";
				    	colHab.innerText = data.habitat == null ? "None" : data.habitat.name;
						
				    	var gen = "";
				    	
				    	if(data.id >= 1 && data.id <= 151){
				    		gen = 1
				    	} 
				    	else if(data.id >= 152 && data.id <= 251){
				    		gen = 2
				    	}
				    	else if(data.id >= 252 && data.id <= 386){
				    		gen = 3
				    	}
				    	else if(data.id >= 387 && data.id <= 493){
				    		gen = 4
				    	}
				    	else if(data.id >= 494 && data.id <= 649){
				    		gen = 5
				    	}
				    	else if(data.id >= 650 && data.id <= 721){
				    		gen = 6
				    	}
				    	else if(data.id >= 722 && data.id <= 809){
				    		gen = 7
				    	}
				    	else if(data.id >= 810 && data.id <= 897){
				    		gen = 8
				    	}
				    	else if(data.id >= 898 && data.id <= 1025){
				    		gen = 9
				    	}
				    	else{
				    		gen = 10
				    	}
				    	
				    	colGen.className = "pixel";
				    	colGen.innerText = gen;
				    	///////////////////////////////////////////
				    	fetch(data.evolution_chain.url)
					    .then(response => response.json())
					    .then(data => {
					    	var evoAct = 1;
					    	var evos = 1;
					    	
					    	var foundEvo = false;
					    	var foundMax = false;
					    	
					    	var nextSpecie = data.chain.evolves_to;
					    	var chainSpecie = data.chain;
					    	
					    	for (var i = 0; !foundMax; i++){
					    		if(Object.keys(nextSpecie).length > 0){
					    			evos += 1;
					    			
					    			nextSpecie = nextSpecie[0].evolves_to;
					    		}
					    		else{
					    			foundMax = !foundMax;
					    		}
					    	}

					    	var nextSpecie = data.chain.evolves_to;
					    	var chainSpecie = data.chain;
					    	
					    	for (var i = 0; i < 10; i++){
					    		
					    		if(Object.keys(nextSpecie).length > 0){
					    			if(chainSpecie.species.url == url && !foundEvo){
					    				foundEvo = !foundEvo;
						    			chainSpecie = nextSpecie[0];
						    		}
					    			else if (foundEvo == false || chainSpecie.species.url == url){
					    				evoAct += 1;
					    				chainSpecie = nextSpecie[0];
						    		}
					    			nextSpecie = nextSpecie[0].evolves_to;
					    		}
					    	}
					    	
					    	colEv.className = "pixel";
					    	colEv.innerText = evoAct;
					    	
					    	colEvolutionM.className = "pixel";
					    	colEvolutionM.innerText = evos;
					    	
					    })
				    
				    })
				    
				    intento.innerText = parseInt(intento.innerText) + 1;
			    	apiRow.appendChild(colNa);
			    	apiRow.appendChild(colT1);
			    	apiRow.appendChild(colT2);
			    	apiRow.appendChild(colEv);
			    	apiRow.appendChild(colEvolutionM);
			    	apiRow.appendChild(colColor);
			    	apiRow.appendChild(colHab);
			    	apiRow.appendChild(colGen);
			    	document.getElementById("pokeTry").value = "";
			    })
			    .catch(error => console.error("Error fetching data:", error));
			}

		function changeColor(cell) {
			const currentColor = cell.style.backgroundColor;
			if (currentColor === 'yellow') {
				cell.style.backgroundColor = 'green';
			} else if (currentColor === 'green') {
				cell.style.backgroundColor = "#31adff";
			} else {
				cell.style.backgroundColor = 'yellow';
			}
		}
	</script>
</body>
</html>
